# 1.2.1 umi ä½¿ç”¨

>umiï¼Œä¸­æ–‡å¯å‘éŸ³ä¸ºä¹Œç±³ï¼Œæ˜¯ä¸€ä¸ªå¯æ’æ‹”çš„ä¼ä¸šçº§ react åº”ç”¨æ¡†æ¶ã€‚umi ä»¥è·¯ç”±ä¸ºåŸºç¡€çš„ï¼Œæ”¯æŒç±» next.js çš„çº¦å®šå¼è·¯ç”±ï¼Œä»¥åŠå„ç§è¿›é˜¶çš„è·¯ç”±åŠŸèƒ½ï¼Œå¹¶ä»¥æ­¤è¿›è¡ŒåŠŸèƒ½æ‰©å±•ï¼Œæ¯”å¦‚æ”¯æŒè·¯ç”±çº§çš„æŒ‰éœ€åŠ è½½ã€‚ç„¶åé…ä»¥å®Œå–„çš„æ’ä»¶ä½“ç³»ï¼Œè¦†ç›–ä»æºç åˆ°æ„å»ºäº§ç‰©çš„æ¯ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œæ”¯æŒå„ç§åŠŸèƒ½æ‰©å±•å’Œä¸šåŠ¡éœ€æ±‚ï¼Œç›®å‰å†…å¤–éƒ¨åŠ èµ·æ¥å·²æœ‰ 50+ çš„æ’ä»¶ã€‚

>ğŸ“¦ å¼€ç®±å³ç”¨ï¼Œå†…ç½® reactã€react-router ç­‰
ğŸˆ ç±» next.js ä¸”åŠŸèƒ½å®Œå¤‡çš„è·¯ç”±çº¦å®šï¼ŒåŒæ—¶æ”¯æŒé…ç½®çš„è·¯ç”±æ–¹å¼
ğŸ‰ å®Œå–„çš„æ’ä»¶ä½“ç³»ï¼Œè¦†ç›–ä»æºç åˆ°æ„å»ºäº§ç‰©çš„æ¯ä¸ªç”Ÿå‘½å‘¨æœŸ
ğŸš€ é«˜æ€§èƒ½ï¼Œé€šè¿‡æ’ä»¶æ”¯æŒ PWAã€ä»¥è·¯ç”±ä¸ºå•å…ƒçš„ code splitting ç­‰
ğŸ’ˆ æ”¯æŒé™æ€é¡µé¢å¯¼å‡ºï¼Œé€‚é…å„ç§ç¯å¢ƒï¼Œæ¯”å¦‚ä¸­å°ä¸šåŠ¡ã€æ— çº¿ä¸šåŠ¡ã€eggã€æ”¯ä»˜å®é’±åŒ…ã€äº‘å‡¤è¶ç­‰
ğŸš„ å¼€å‘å¯åŠ¨å¿«ï¼Œæ”¯æŒä¸€é”®å¼€å¯ dll å’Œ hard-source-webpack-plugin ç­‰
ğŸ  ä¸€é”®å…¼å®¹åˆ° IE9ï¼ŒåŸºäº umi-plugin-polyfills
ğŸ å®Œå–„çš„ TypeScript æ”¯æŒï¼ŒåŒ…æ‹¬ d.ts å®šä¹‰å’Œ umi test
ğŸŒ´ ä¸ dva æ•°æ®æµçš„æ·±å…¥èåˆï¼Œæ”¯æŒ duck directoryã€model çš„è‡ªåŠ¨åŠ è½½ã€code splitting ç­‰ç­‰

![](https://gw.alipayobjects.com/zos/rmsportal/zvfEXesXdgTzWYZCuHLe.png)



## install

```
# å…¨å±€å®‰è£… umi

yarn global add umi

ä½¿ç”¨ yarn å®‰è£…åå…¨å±€è¿˜æ˜¯ä¸èƒ½ä½¿ç”¨ umiï¼Œ
[è§£å†³æ–¹æ³•](https://github.com/fairyly/mynodejs/blob/gh-pages/1.2.5%20%E8%A7%A3%E5%86%B3yarn%E5%85%A8%E5%B1%80%E5%AE%89%E8%A3%85%E6%A8%A1%E5%9D%97%E5%90%8E%E4%BD%86%E4%BB%8D%E6%8F%90%E7%A4%BA%E6%97%A0%E6%B3%95%E6%89%BE%E5%88%B0%E5%91%BD%E4%BB%A4%E7%9A%84%E9%97%AE%E9%A2%98.md)

æœ€åæ”¹ç”¨ npm i -g umi

å‡ºç°é—®é¢˜ï¼š
npm ERR! code ETARGET
npm ERR! notarget No matching version found for @babel/generator@^7.2.2
npm ERR! notarget In most cases you or one of your dependencies are requesting
npm ERR! notarget a package version that doesn't exist.
npm ERR! notarget
npm ERR! notarget It was specified as a dependency of '@babel/core'
npm ERR! notarget

ç”±äºåŸæ¥ä½¿ç”¨çš„æ˜¯å…¬å¸çš„æºï¼Œå°±åˆ‡æ¢åˆ° æ·˜å®æºä¹‹åé‡æ–°å®‰è£…å°±å¯ä»¥äº†

```

## usageï¼ˆtestï¼‰

```
å»ºä¸ªç©ºç›®å½•:
mkdir myapp && cd myapp

é€šè¿‡ umi g åˆ›å»ºä¸€äº›é¡µé¢:

$ umi g page index
$ umi g page users

```

## é€šè¿‡è„šæ‰‹æ¶åˆ›å»ºé¡¹ç›®

```
mkdir myapp && cd myapp
npm create umi

é€‰æ‹© app

? Do you want to use typescript? (y/N) n

é€‰æ‹© antd



åˆ›å»ºå®Œæˆ 

npm start å¯åŠ¨
```

## ç›®å½•
```
ä¸€ä¸ªå¤æ‚åº”ç”¨çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

.
â”œâ”€â”€ dist/                          // é»˜è®¤çš„ build è¾“å‡ºç›®å½•
â”œâ”€â”€ mock/                          // mock æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼ŒåŸºäº express
â”œâ”€â”€ config/
    â”œâ”€â”€ config.js                  // umi é…ç½®ï¼ŒåŒ .umirc.jsï¼ŒäºŒé€‰ä¸€
â””â”€â”€ src/                           // æºç ç›®å½•ï¼Œå¯é€‰
    â”œâ”€â”€ layouts/index.js           // å…¨å±€å¸ƒå±€
    â”œâ”€â”€ pages/                     // é¡µé¢ç›®å½•ï¼Œé‡Œé¢çš„æ–‡ä»¶å³è·¯ç”±
        â”œâ”€â”€ .umi/                  // dev ä¸´æ—¶ç›®å½•ï¼Œéœ€æ·»åŠ åˆ° .gitignore
        â”œâ”€â”€ .umi-production/       // build ä¸´æ—¶ç›®å½•ï¼Œä¼šè‡ªåŠ¨åˆ é™¤
        â”œâ”€â”€ document.ejs           // HTML æ¨¡æ¿
        â”œâ”€â”€ 404.js                 // 404 é¡µé¢
        â”œâ”€â”€ page1.js               // é¡µé¢ 1ï¼Œä»»æ„å‘½åï¼Œå¯¼å‡º react ç»„ä»¶
        â”œâ”€â”€ page1.test.js          // ç”¨ä¾‹æ–‡ä»¶ï¼Œumi test ä¼šåŒ¹é…æ‰€æœ‰ .test.js å’Œ .e2e.js ç»“å°¾çš„æ–‡ä»¶
        â””â”€â”€ page2.js               // é¡µé¢ 2ï¼Œä»»æ„å‘½å
    â”œâ”€â”€ global.css                 // çº¦å®šçš„å…¨å±€æ ·å¼æ–‡ä»¶ï¼Œè‡ªåŠ¨å¼•å…¥ï¼Œä¹Ÿå¯ä»¥ç”¨ global.less
    â”œâ”€â”€ global.js                  // å¯ä»¥åœ¨è¿™é‡ŒåŠ å…¥ polyfill
    â”œâ”€â”€ app.js                     // è¿è¡Œæ—¶é…ç½®æ–‡ä»¶
â”œâ”€â”€ .umirc.js                      // umi é…ç½®ï¼ŒåŒ config/config.jsï¼ŒäºŒé€‰ä¸€
â”œâ”€â”€ .env                           // ç¯å¢ƒå˜é‡
â””â”€â”€ package.json
```

>.umi ä¸­ä¼šç”Ÿæˆä¸€äº›é…ç½®æ–‡ä»¶ï¼Œå¦‚æœ¬åœ°è·¯ç”±é…ç½®ç­‰  
æ³¨æ„ï¼šï¼ˆä¸è¦ç›´æ¥åœ¨è¿™é‡Œä¿®æ”¹ä»£ç ï¼Œumi é‡å¯æˆ–è€… pages ä¸‹çš„æ–‡ä»¶ä¿®æ”¹éƒ½ä¼šé‡æ–°ç”Ÿæˆè¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ã€‚ï¼‰


## è·¯ç”±
>ä»‹ç»çš„è·¯ç”±ä½¿ç”¨å¯ä»¥åœ¨ [umi-examples/routes](https://github.com/umijs/umi-examples/tree/master/routes) å’Œ [umi-examples/routes-via-config](https://github.com/umijs/umi-examples/tree/master/routes-via-config) é‡Œæ‰¾åˆ°ç¤ºä¾‹ä»£ç 

#### çº¦å®šå¼è·¯ç”±
>çº¦å®š pages ä¸‹æ‰€æœ‰çš„ jsã€jsxã€ts å’Œ tsx æ–‡ä»¶å³è·¯ç”±ã€‚
###### åŸºç¡€è·¯ç”±

å‡è®¾ pages ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```
+ pages/  
  + users/  
    - index.js  
    - list.js  
  - index.js  
```

é‚£ä¹ˆï¼Œumi ä¼šè‡ªåŠ¨ç”Ÿæˆè·¯ç”±é…ç½®å¦‚ä¸‹ï¼š

```
[
  { path: '/', component: './pages/index.js' },
  { path: '/users/', component: './pages/users/index.js' },
  { path: '/users/list', component: './pages/users/list.js' },
]
```

#### åŠ¨æ€è·¯ç”±

>umi é‡Œçº¦å®šï¼Œå¸¦ $ å‰ç¼€çš„ç›®å½•æˆ–æ–‡ä»¶ä¸ºåŠ¨æ€è·¯ç”±ã€‚

æ¯”å¦‚ä»¥ä¸‹ç›®å½•ç»“æ„ï¼š

```
+ pages/
  + $post/
    - index.js
    - comments.js
  + users/
    $id.js
  - index.js
```

ä¼šç”Ÿæˆè·¯ç”±é…ç½®å¦‚ä¸‹ï¼š

```
[
  { path: '/', component: './pages/index.js' },
  { path: '/users/:id', component: './pages/users/$id.js' },
  { path: '/:post/', component: './pages/$post/index.js' },
  { path: '/:post/comments', component: './pages/$post/comments.js' },
]
```


#### å¯é€‰çš„åŠ¨æ€è·¯ç”±

>umi é‡Œçº¦å®šåŠ¨æ€è·¯ç”±å¦‚æœå¸¦ $ åç¼€ï¼Œåˆ™ä¸ºå¯é€‰åŠ¨æ€è·¯ç”±ã€‚

æ¯”å¦‚ä»¥ä¸‹ç»“æ„ï¼š

```
+ pages/
  + users/
    - $id$.js
  - index.js
```

ä¼šç”Ÿæˆè·¯ç”±é…ç½®å¦‚ä¸‹ï¼š

```
[
  { path: '/': component: './pages/index.js' },
  { path: '/users/:id?': component: './pages/users/$id$.js' },
]
```


##### åµŒå¥—è·¯ç”±
>umi é‡Œçº¦å®šç›®å½•ä¸‹æœ‰ _layout.js æ—¶ä¼šç”ŸæˆåµŒå¥—è·¯ç”±ï¼Œä»¥ _layout.js ä¸ºè¯¥ç›®å½•çš„ layout ã€‚

æ¯”å¦‚ä»¥ä¸‹ç›®å½•ç»“æ„ï¼š

```
+ pages/
  + users/
    - _layout.js
    - $id.js
    - index.js
```

ä¼šç”Ÿæˆè·¯ç”±é…ç½®å¦‚ä¸‹ï¼š

```
[
  { path: '/users', component: './pages/users/_layout.js',
    routes: [
     { path: '/users/', component: './pages/users/index.js' },
     { path: '/users/:id', component: './pages/users/$id.js' },
   ],
  },
]
```

# å…¨å±€ layout
>çº¦å®š src/layouts/index.js ä¸ºå…¨å±€è·¯ç”±ï¼Œè¿”å›ä¸€ä¸ª React ç»„ä»¶ï¼Œé€šè¿‡ props.children æ¸²æŸ“å­ç»„ä»¶ã€‚

æ¯”å¦‚ï¼š

```
export default function(props) {
  return (
    <>
      <Header />
      { props.children }
      <Footer />
    </>
  );
}
```

##### ä¸åŒçš„å…¨å±€ layout
>ä½ å¯èƒ½éœ€è¦é’ˆå¯¹ä¸åŒè·¯ç”±è¾“å‡ºä¸åŒçš„å…¨å±€ layoutï¼Œumi ä¸æ”¯æŒè¿™æ ·çš„é…ç½®ï¼Œ    
ä½†ä½ ä»å¯ä»¥åœ¨ layouts/index.js å¯¹ location.path åšåŒºåˆ†ï¼Œæ¸²æŸ“ä¸åŒçš„ layout ã€‚

æ¯”å¦‚æƒ³è¦é’ˆå¯¹ /login è¾“å‡ºç®€å•å¸ƒå±€ï¼Œ

```
export default function(props) {
  if (props.location.pathname === '/login') {
    return <SimpleLayout>{ props.children }</SimpleLayout>
  }

  return (
    <>
      <Header />
      { props.children }
      <Footer />
    </>
  );
}
```

##### 404 è·¯ç”±
>çº¦å®š pages/404.js ä¸º 404 é¡µé¢ï¼Œéœ€è¿”å› React ç»„ä»¶ã€‚

æ¯”å¦‚ï¼š

```
export default () => {
  return (
    <div>I am a customized 404 page</div>
  );
};
```

>æ³¨æ„ï¼šå¼€å‘æ¨¡å¼ä¸‹ï¼Œumi ä¼šæ·»åŠ ä¸€ä¸ªé»˜è®¤çš„ 404 é¡µé¢æ¥è¾…åŠ©å¼€å‘ï¼Œä½†ä½ ä»ç„¶å¯é€šè¿‡ç²¾ç¡®åœ°è®¿é—® /404 æ¥éªŒè¯ 404 é¡µé¢ã€‚


##### é…ç½®å¼è·¯ç”±

>å¦‚æœä½ å€¾å‘äºä½¿ç”¨é…ç½®å¼çš„è·¯ç”±ï¼Œå¯ä»¥é…ç½® routes ï¼Œæ­¤é…ç½®é¡¹å­˜åœ¨æ—¶åˆ™ä¸ä¼šå¯¹ src/pages ç›®å½•åšçº¦å®šå¼çš„è§£æã€‚

æ¯”å¦‚ï¼š

```
export default {
  routes: [
    { path: '/', component: './a' },
    { path: '/list', component: './b', Routes: ['./routes/PrivateRoute.js'] },
    { path: '/users', component: './users/_layout',
      routes: [
        { path: '/users/detail', component: './users/detail' },
        { path: '/users/:id', component: './users/id' }
      ]
    },
  ],
};
```


>æ³¨æ„ï¼šcomponent æ˜¯ç›¸å¯¹äº src/pages ç›®å½•çš„


##### æƒé™è·¯ç”±
>umi çš„æƒé™è·¯ç”±æ˜¯é€šè¿‡é…ç½®è·¯ç”±çš„ Routes å±æ€§æ¥å®ç°ã€‚çº¦å®šå¼çš„é€šè¿‡ yaml æ³¨é‡Šæ·»åŠ ï¼Œé…ç½®å¼çš„ç›´æ¥é…ä¸Šå³å¯ã€‚

æ¯”å¦‚æœ‰ä»¥ä¸‹é…ç½®ï¼š

```
[
  { path: '/', component: './pages/index.js' },
  { path: '/list', component: './pages/list.js', Routes: ['./routes/PrivateRoute.js'] },
]
```

ç„¶å umi ä¼šç”¨ ./routes/PrivateRoute.js æ¥æ¸²æŸ“ /listã€‚

./routes/PrivateRoute.js æ–‡ä»¶ç¤ºä¾‹ï¼š

```
export default (props) => {
  return (
    <div>
      <div>PrivateRoute (routes/PrivateRoute.js)</div>
      { props.children }
    </div>
  );
}
```

##### å¯ç”¨ Hash è·¯ç”±
>umi é»˜è®¤æ˜¯ç”¨çš„ Browser Historyï¼Œå¦‚æœè¦ç”¨ Hash Historyï¼Œéœ€é…ç½®ï¼š

```
export default {
  history: 'hash',
}
```






## å‚è€ƒ
- [docs](https://umijs.org/zh/guide/getting-started.html)

