(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{230:function(n,s,a){"use strict";a.r(s);var e=a(0),t=Object(e.a)({},function(){var n=this,s=n.$createElement,a=n._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[a("h2",{attrs:{id:"_3-2-9-promise"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-9-promise","aria-hidden":"true"}},[n._v("#")]),n._v(" 3.2.9 Promise")]),n._v(" "),a("blockquote",[a("p",[n._v("目前实现按照正常的思路走下来的，可能会存在些问题")])]),n._v(" "),a("h1",{attrs:{id:"实现一个-promise"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实现一个-promise","aria-hidden":"true"}},[n._v("#")]),n._v(" 实现一个 promise")]),n._v(" "),a("h2",{attrs:{id:"_1-初步构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-初步构建","aria-hidden":"true"}},[n._v("#")]),n._v(" 1.初步构建")]),n._v(" "),a("blockquote",[a("p",[n._v("Promise 的参数是函数 fn，"),a("br"),n._v("\n把内部定义 resolve 方法作为参数传到 fn 中，调用 fn。"),a("br"),n._v("\n当异步操作成功后会调用 resolve 方法，"),a("br"),n._v("\n然后就会执行 then 中注册的回调函数。")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("function Promise(fn){\n  //需要一个成功时的回调\n  var doneCallback;\n  //一个实例的方法，用来注册异步事件\n  this.then = function(done){\n    doneCallback = done;\n  }\n  function resolve(){\n    doneCallback();\n  }\n  fn(resolve);\n}\n\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br")])]),a("h2",{attrs:{id:"_2-加入链式支持"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-加入链式支持","aria-hidden":"true"}},[n._v("#")]),n._v(" 2.加入链式支持")]),n._v(" "),a("blockquote",[a("p",[n._v("下面加入链式，成功回调的方法就得变成数组才能存储。同时我们给 resolve 方法添加参数，这样就不会输出 undefined。")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("下面加入链式，成功回调的方法就得变成数组才能存储\n\nfunction Promise(fn){\n  //需要成功以及成功时的回调\n  var doneList = [];\n  //一个实例的方法，用来注册异步事件\n  this.then = function(done ,fail){\n    doneList.push(done);\n    return this;\n  }\n  function resolve(){\n    doneList.forEach(function(fulfill){\n      fulfill();\n    });\n  }\n  fn(resolve);\n}\n\n\n这里promise里面如果是同步的函数的话，doneList里面还是空的，所以可以加个setTimeout来将这个放到js的最后执行。\n\n这里主要是参照了promiseA+的规范，就像这样\n\nfunction resolve(){\n  setTimeout(function(){\n    doneList.forEach(function(fulfill){\n      fulfill();\n    });\n  },0);\n}\n\n\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br")])]),a("h2",{attrs:{id:"_3-引入状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-引入状态","aria-hidden":"true"}},[n._v("#")]),n._v(" 3.引入状态")]),n._v(" "),a("blockquote",[a("p",[n._v("这时如果promise已经执行完了，我们再给promise注册then方法就怎么都不会执行了，这个不符合预期，所以才会加入状态这种东西。更新过的代码如下")])]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v('function Promise(fn){\n  //需要成功以及成功时的回调\n  var state = \'pending\';\n  var doneList = [];\n  //一个实例的方法，用来注册异步事件\n  this.then = function(done){\n    switch(state){\n      case "pending":\n        doneList.push(done);\n        return this;\n        break;\n      case \'fulfilled\':\n        done();\n        return this;\n        break;\n    }\n  }\n  function resolve(){\n    state = "fulfilled";\n    setTimeout(function(){\n      doneList.forEach(function(fulfill){\n        fulfill();\n      });\n    },0);\n  }\n  fn(resolve);\n}\n\n\n加上结果的传递：\n\nfunction resolve(newValue){\n  state = "fulfilled";\n  var value = newValue;\n  setTimeout(function(){\n    doneList.forEach(function(fulfill){\n      value = fulfill(value);\n    });\n  },0);\n}\n\n\n')])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br"),a("span",{staticClass:"line-number"},[n._v("37")]),a("br"),a("span",{staticClass:"line-number"},[n._v("38")]),a("br"),a("span",{staticClass:"line-number"},[n._v("39")]),a("br"),a("span",{staticClass:"line-number"},[n._v("40")]),a("br"),a("span",{staticClass:"line-number"},[n._v("41")]),a("br"),a("span",{staticClass:"line-number"},[n._v("42")]),a("br")])]),a("h2",{attrs:{id:"_4-支持串行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-支持串行","aria-hidden":"true"}},[n._v("#")]),n._v(" 4.支持串行")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("function Promise(fn){\n  //需要成功以及成功时的回调\n  var state = 'pending';\n  var doneList = [];\n  this.then = function(done){\n    switch(state){\n      case \"pending\":\n        doneList.push(done);\n        return this;\n        break;\n      case 'fulfilled':\n        done();\n        return this;\n        break;\n    }\n  }\n  function resolve(newValue){\n    state = \"fulfilled\";\n    setTimeout(function(){\n      var value = newValue;\n      //执行resolve时，我们会尝试将doneList数组中的值都执行一遍\n      //当遇到正常的回调函数的时候，就执行回调函数\n      //当遇到一个新的promise的时候，就将原doneList数组里的回调函数推入新的promise的doneList，以达到循环的目的\n      for (var i = 0;i<doneList.length;i++){\n        var temp = doneList[i](value)\n        if(temp instanceof Promise){\n            var newP =  temp;\n            for(i++;i<doneList.length;i++){\n                newP.then(doneList[i]);\n            }\n        }else{\n            value = temp;\n        }\n      }\n    },0);\n  }\n  fn(resolve);\n}\n\n\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br"),a("span",{staticClass:"line-number"},[n._v("37")]),a("br"),a("span",{staticClass:"line-number"},[n._v("38")]),a("br"),a("span",{staticClass:"line-number"},[n._v("39")]),a("br"),a("span",{staticClass:"line-number"},[n._v("40")]),a("br")])]),a("h2",{attrs:{id:"_5-加入reject"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-加入reject","aria-hidden":"true"}},[n._v("#")]),n._v(" 5.加入reject")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("function Promise(fn){\n  var state = 'pending';\n  var doneList = [];\n  var failList= [];\n  this.then = function(done ,fail){\n    switch(state){\n      case \"pending\":\n        doneList.push(done);\n        //每次如果没有推入fail方法，我也会推入一个null来占位\n        failList.push(fail || null);\n        return this;\n        break;\n      case 'fulfilled':\n        done();\n        return this;\n        break;\n      case 'rejected':\n        fail();\n        return this;\n        break;\n    }\n  }\n  function resolve(newValue){\n    state = \"fulfilled\";\n    setTimeout(function(){\n      var value = newValue;\n      for (var i = 0;i<doneList.length;i++){\n        var temp = doneList[i](value);\n        if(temp instanceof Promise){\n            var newP =  temp;\n            for(i++;i<doneList.length;i++){\n                newP.then(doneList[i],failList[i]);\n            }\n        }else{\n            value = temp;\n        }\n      }\n    },0);\n  }\n  function reject(newValue){\n    state = \"rejected\";\n    setTimeout(function(){\n      var value = newValue;\n      var tempRe = failList[0](value);\n      //如果reject里面传入了一个promise，那么执行完此次的fail之后，将剩余的done和fail传入新的promise中\n      if(tempRe instanceof Promise){\n        var newP = tempRe;\n        for(i=1;i<doneList.length;i++){\n            newP.then(doneList[i],failList[i]);\n        }\n      }else{\n        //如果不是promise，执行完当前的fail之后，继续执行doneList\n        value =  tempRe;\n        doneList.shift();\n        failList.shift();\n        resolve(value);\n      }\n    },0);\n  }\n  fn(resolve,reject);\n}\n\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br"),a("span",{staticClass:"line-number"},[n._v("35")]),a("br"),a("span",{staticClass:"line-number"},[n._v("36")]),a("br"),a("span",{staticClass:"line-number"},[n._v("37")]),a("br"),a("span",{staticClass:"line-number"},[n._v("38")]),a("br"),a("span",{staticClass:"line-number"},[n._v("39")]),a("br"),a("span",{staticClass:"line-number"},[n._v("40")]),a("br"),a("span",{staticClass:"line-number"},[n._v("41")]),a("br"),a("span",{staticClass:"line-number"},[n._v("42")]),a("br"),a("span",{staticClass:"line-number"},[n._v("43")]),a("br"),a("span",{staticClass:"line-number"},[n._v("44")]),a("br"),a("span",{staticClass:"line-number"},[n._v("45")]),a("br"),a("span",{staticClass:"line-number"},[n._v("46")]),a("br"),a("span",{staticClass:"line-number"},[n._v("47")]),a("br"),a("span",{staticClass:"line-number"},[n._v("48")]),a("br"),a("span",{staticClass:"line-number"},[n._v("49")]),a("br"),a("span",{staticClass:"line-number"},[n._v("50")]),a("br"),a("span",{staticClass:"line-number"},[n._v("51")]),a("br"),a("span",{staticClass:"line-number"},[n._v("52")]),a("br"),a("span",{staticClass:"line-number"},[n._v("53")]),a("br"),a("span",{staticClass:"line-number"},[n._v("54")]),a("br"),a("span",{staticClass:"line-number"},[n._v("55")]),a("br"),a("span",{staticClass:"line-number"},[n._v("56")]),a("br"),a("span",{staticClass:"line-number"},[n._v("57")]),a("br"),a("span",{staticClass:"line-number"},[n._v("58")]),a("br"),a("span",{staticClass:"line-number"},[n._v("59")]),a("br"),a("span",{staticClass:"line-number"},[n._v("60")]),a("br"),a("span",{staticClass:"line-number"},[n._v("61")]),a("br"),a("span",{staticClass:"line-number"},[n._v("62")]),a("br")])]),a("h2",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考","aria-hidden":"true"}},[n._v("#")]),n._v(" 参考")]),n._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"https://www.jianshu.com/p/473cd754311f",target:"_blank",rel:"noopener noreferrer"}},[n._v("Promise简单实现（正常思路版）"),a("OutboundLink")],1)])]),n._v(" "),a("li",[a("p",[a("a",{attrs:{href:"http://www.cnblogs.com/huansky/p/6064402.html",target:"_blank",rel:"noopener noreferrer"}},[n._v("手把手教你实现一个完整的 Promise"),a("OutboundLink")],1)]),n._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/huanshen/Promise/tree/master",target:"_blank",rel:"noopener noreferrer"}},[n._v("github"),a("OutboundLink")],1)])])]),n._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://promisesaplus.com/",target:"_blank",rel:"noopener noreferrer"}},[n._v("主流规范---Promises/A+"),a("OutboundLink")],1)])]),n._v(" "),a("li",[a("p",[a("a",{attrs:{href:"http://coderlt.coding.me/2016/12/04/promise-in-depth-an-introduction-2/",target:"_blank",rel:"noopener noreferrer"}},[n._v("深入理解 Promise"),a("OutboundLink")],1)])]),n._v(" "),a("li",[a("p",[a("a",{attrs:{href:""}})])])])])},[],!1,null,null,null);s.default=t.exports}}]);